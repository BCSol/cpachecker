/* Generated by CIL v. 1.3.6 */
/* print_CIL_Input is true */

#line 4 "floppy_simpl4_BUG.cil.c"
void errorFn(void) ;
#line 5
void _BLAST_init(void) ;
#line 6
int FlAcpiConfigureFloppy(int DisketteExtension , int FdcInfo ) ;
#line 7
int FlQueueIrpToThread(int Irp , int DisketteExtension ) ;
#line 8
int FloppyPnp(int DeviceObject , int Irp ) ;
#line 9
int FloppyStartDevice(int DeviceObject , int Irp ) ;
#line 10
int FloppyPnpComplete(int DeviceObject , int Irp , int Context ) ;
#line 11
int FlFdcDeviceIo(int DeviceObject , int Ioctl , int Data ) ;
#line 12
void FloppyProcessQueuedRequests(int DisketteExtension ) ;
#line 13
void stub_driver_init(void) ;
#line 14
int IoBuildDeviceIoControlRequest(int IoControlCode , int DeviceObject , int InputBuffer ,
                                  int InputBufferLength , int OutputBuffer , int OutputBufferLength ,
                                  int InternalDeviceIoControl , int Event , int IoStatusBlock ) ;
#line 17
int IoDeleteSymbolicLink(int SymbolicLinkName ) ;
#line 18
int IoQueryDeviceDescription(int BusType , int BusNumber , int ControllerType , int ControllerNumber ,
                             int PeripheralType , int PeripheralNumber , int CalloutRoutine ,
                             int Context ) ;
#line 21
int IoRegisterDeviceInterface(int PhysicalDeviceObject , int InterfaceClassGuid ,
                              int ReferenceString , int SymbolicLinkName ) ;
#line 23
int IoSetDeviceInterfaceState(int SymbolicLinkName , int Enable ) ;
#line 24
void stubMoreProcessingRequired(void) ;
#line 25
int IofCallDriver(int DeviceObject , int Irp ) ;
#line 26
void IofCompleteRequest(int Irp , int PriorityBoost ) ;
#line 27
int KeSetEvent(int Event , int Increment , int Wait ) ;
#line 28
int KeWaitForSingleObject(int Object , int WaitReason , int WaitMode , int Alertable ,
                          int Timeout ) ;
#line 30
int ObReferenceObjectByHandle(int Handle , int DesiredAccess , int ObjectType , int AccessMode ,
                              int Object , int HandleInformation ) ;
#line 32
int PsCreateSystemThread(int ThreadHandle , int DesiredAccess , int ObjectAttributes ,
                         int ProcessHandle , int ClientId , int StartRoutine , int StartContext ) ;
#line 34
int ZwClose(int Handle ) ;
#line 35
int FloppyCreateClose(int DeviceObject , int Irp ) ;
#line 36
int FloppyDeviceControl(int DeviceObject , int Irp ) ;
#line 37
int FlCheckFormatParameters(int DisketteExtension , int FormatParameters ) ;
#line 38 "floppy_simpl4_BUG.cil.c"
int FloppyThread  ;
#line 39 "floppy_simpl4_BUG.cil.c"
int KernelMode  ;
#line 40 "floppy_simpl4_BUG.cil.c"
int Suspended  ;
#line 41 "floppy_simpl4_BUG.cil.c"
int Executive  ;
#line 42 "floppy_simpl4_BUG.cil.c"
int DiskController  ;
#line 43 "floppy_simpl4_BUG.cil.c"
int FloppyDiskPeripheral  ;
#line 44 "floppy_simpl4_BUG.cil.c"
int FlConfigCallBack  ;
#line 45 "floppy_simpl4_BUG.cil.c"
int MaximumInterfaceType  ;
#line 46 "floppy_simpl4_BUG.cil.c"
int MOUNTDEV_MOUNTED_DEVICE_GUID  ;
#line 47 "floppy_simpl4_BUG.cil.c"
void errorFn(void) 
{ 

  {
  goto ERROR;
  ERROR: 
#line 53
  return;
}
}
#line 56 "floppy_simpl4_BUG.cil.c"
int myStatus  ;
#line 57 "floppy_simpl4_BUG.cil.c"
int s  ;
#line 58 "floppy_simpl4_BUG.cil.c"
int UNLOADED  ;
#line 59 "floppy_simpl4_BUG.cil.c"
int NP  ;
#line 60 "floppy_simpl4_BUG.cil.c"
int DC  ;
#line 61 "floppy_simpl4_BUG.cil.c"
int SKIP1  ;
#line 62 "floppy_simpl4_BUG.cil.c"
int SKIP2  ;
#line 63 "floppy_simpl4_BUG.cil.c"
int MPR1  ;
#line 64 "floppy_simpl4_BUG.cil.c"
int MPR3  ;
#line 65 "floppy_simpl4_BUG.cil.c"
int IPC  ;
#line 66 "floppy_simpl4_BUG.cil.c"
int pended  ;
#line 67 "floppy_simpl4_BUG.cil.c"
int compRegistered  ;
#line 68 "floppy_simpl4_BUG.cil.c"
int lowerDriverReturn  ;
#line 69 "floppy_simpl4_BUG.cil.c"
int setEventCalled  ;
#line 70 "floppy_simpl4_BUG.cil.c"
int customIrp  ;
#line 71 "floppy_simpl4_BUG.cil.c"
void _BLAST_init(void) 
{ 

  {
#line 75
  UNLOADED = 0;
#line 76
  NP = 1;
#line 77
  DC = 2;
#line 78
  SKIP1 = 3;
#line 79
  SKIP2 = 4;
#line 80
  MPR1 = 5;
#line 81
  MPR3 = 6;
#line 82
  IPC = 7;
#line 83
  s = UNLOADED;
#line 84
  pended = 0;
#line 85
  compRegistered = 0;
#line 86
  lowerDriverReturn = 0;
#line 87
  setEventCalled = 0;
#line 88
  customIrp = 0;
#line 89
  return;
}
}
#line 92 "floppy_simpl4_BUG.cil.c"
int PagingReferenceCount  =    0;
#line 93 "floppy_simpl4_BUG.cil.c"
int PagingMutex  =    0;
#line 94 "floppy_simpl4_BUG.cil.c"
int FlAcpiConfigureFloppy(int DisketteExtension , int FdcInfo ) 
{ 

  {
#line 98
  return (0);
}
}
#line 101 "floppy_simpl4_BUG.cil.c"
int FlQueueIrpToThread(int Irp , int DisketteExtension ) 
{ int status ;
  int threadHandle ;
  int DisketteExtension__PoweringDown ;
  int DisketteExtension__ThreadReferenceCount ;
  int DisketteExtension__FloppyThread ;
  int Irp__IoStatus__Status ;
  int Irp__IoStatus__Information ;
  int Irp__Tail__Overlay__CurrentStackLocation__Control ;
  int ObjAttributes ;
  int __cil_tmp12 ;
  int __cil_tmp13 ;

  {
#line 113
  if (DisketteExtension__PoweringDown == 1) {
#line 114
    myStatus = -1073741101;
#line 115
    Irp__IoStatus__Status = -1073741101;
#line 116
    Irp__IoStatus__Information = 0;
#line 117
    return (-1073741101);
  }
#line 121
  DisketteExtension__ThreadReferenceCount ++;
#line 122
  if (DisketteExtension__ThreadReferenceCount == 0) {
#line 123
    DisketteExtension__ThreadReferenceCount ++;
#line 124
    PagingReferenceCount ++;
#line 125
    if (PagingReferenceCount == 1) {

    }
    {
#line 131
    status = PsCreateSystemThread(threadHandle, 0, ObjAttributes, 0, 0, FloppyThread,
                                  DisketteExtension);
    }
    {
#line 134
    __cil_tmp12 = status >= 0;
#line 134
    if (! __cil_tmp12) {
#line 135
      DisketteExtension__ThreadReferenceCount = -1;
#line 136
      PagingReferenceCount --;
#line 137
      if (PagingReferenceCount == 0) {

      }
#line 142
      return (status);
    }
    }
    {
#line 147
    status = ObReferenceObjectByHandle(threadHandle, 1048576, 0, KernelMode, DisketteExtension__FloppyThread,
                                       0);
#line 149
    ZwClose(threadHandle);
    }
    {
#line 151
    __cil_tmp13 = status >= 0;
#line 151
    if (! __cil_tmp13) {
#line 152
      return (status);
    }
    }
  }
#line 159
  Irp__Tail__Overlay__CurrentStackLocation__Control |= 1;
#line 160
  if (pended == 0) {
#line 161
    pended = 1;
  } else {
    {
#line 164
    errorFn();
    }
  }
#line 167
  return (259);
}
}
#line 170 "floppy_simpl4_BUG.cil.c"
int FloppyPnp(int DeviceObject , int Irp ) 
{ int DeviceObject__DeviceExtension ;
  int Irp__Tail__Overlay__CurrentStackLocation ;
  int Irp__IoStatus__Information ;
  int Irp__IoStatus__Status ;
  int Irp__CurrentLocation ;
  int disketteExtension__IsRemoved ;
  int disketteExtension__IsStarted ;
  int disketteExtension__TargetObject ;
  int disketteExtension__HoldNewRequests ;
  int disketteExtension__FloppyThread ;
  int disketteExtension__InterfaceString__Buffer ;
  int disketteExtension__InterfaceString ;
  int disketteExtension__ArcName__Length ;
  int disketteExtension__ArcName ;
  int irpSp__MinorFunction ;
  int IoGetConfigurationInformation__FloppyCount ;
  int irpSp ;
  int disketteExtension ;
  int ntStatus ;
  int doneEvent ;
  int irpSp___0 ;
  int nextIrpSp ;
  int nextIrpSp__Control ;
  int irpSp___1 ;
  int irpSp__Context ;
  int irpSp__Control ;
  long __cil_tmp29 ;
  long __cil_tmp30 ;

  {
#line 199
  ntStatus = 0;
#line 200
  PagingReferenceCount ++;
#line 201
  if (PagingReferenceCount == 1) {

  }
#line 206
  disketteExtension = DeviceObject__DeviceExtension;
#line 207
  irpSp = Irp__Tail__Overlay__CurrentStackLocation;
#line 208
  if (disketteExtension__IsRemoved) {
    {
#line 210
    Irp__IoStatus__Information = 0;
#line 211
    Irp__IoStatus__Status = -1073741738;
#line 212
    myStatus = -1073741738;
#line 213
    IofCompleteRequest(Irp, 0);
    }
#line 215
    return (-1073741738);
  }
#line 219
  if (irpSp__MinorFunction == 0) {
    goto switch_0_0;
  } else {
#line 222
    if (irpSp__MinorFunction == 5) {
      goto switch_0_5;
    } else {
#line 225
      if (irpSp__MinorFunction == 1) {
        goto switch_0_5;
      } else {
#line 228
        if (irpSp__MinorFunction == 6) {
          goto switch_0_6;
        } else {
#line 231
          if (irpSp__MinorFunction == 3) {
            goto switch_0_6;
          } else {
#line 234
            if (irpSp__MinorFunction == 4) {
              goto switch_0_4;
            } else {
#line 237
              if (irpSp__MinorFunction == 2) {
                goto switch_0_2;
              } else {
                goto switch_0_default;
#line 242
                if (0) {
                  switch_0_0: 
                  {
#line 245
                  ntStatus = FloppyStartDevice(DeviceObject, Irp);
                  }
                  goto switch_0_break;
                  switch_0_5: 
#line 250
                  if (irpSp__MinorFunction == 5) {

                  }
#line 255
                  if (! disketteExtension__IsStarted) {
#line 256
                    if (s == NP) {
#line 257
                      s = SKIP1;
                    } else {
                      {
#line 260
                      errorFn();
                      }
                    }
                    {
#line 264
                    Irp__CurrentLocation ++;
#line 265
                    Irp__Tail__Overlay__CurrentStackLocation ++;
#line 266
                    ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                    }
#line 268
                    return (ntStatus);
                  }
                  {
#line 273
                  disketteExtension__HoldNewRequests = 1;
#line 274
                  ntStatus = FlQueueIrpToThread(Irp, disketteExtension);
                  }
                  {
#line 276
                  __cil_tmp29 = (long )ntStatus;
#line 276
                  if (__cil_tmp29 == 259L) {
                    {
#line 278
                    KeWaitForSingleObject(disketteExtension__FloppyThread, Executive,
                                          KernelMode, 0, 0);
                    }
#line 281
                    if (disketteExtension__FloppyThread != 0) {

                    }
#line 286
                    disketteExtension__FloppyThread = 0;
#line 287
                    Irp__IoStatus__Status = 0;
#line 288
                    myStatus = 0;
#line 289
                    if (s == NP) {
#line 290
                      s = SKIP1;
                    } else {
                      {
#line 293
                      errorFn();
                      }
                    }
                    {
#line 297
                    Irp__CurrentLocation ++;
#line 298
                    Irp__Tail__Overlay__CurrentStackLocation ++;
#line 299
                    ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                    }
                  } else {
                    {
#line 303
                    ntStatus = -1073741823;
#line 304
                    Irp__IoStatus__Status = ntStatus;
#line 305
                    myStatus = ntStatus;
#line 306
                    Irp__IoStatus__Information = 0;
#line 307
                    IofCompleteRequest(Irp, 0);
                    }
                  }
                  }
                  goto switch_0_break;
                  switch_0_6: 
#line 313
                  if (irpSp__MinorFunction == 6) {

                  }
#line 318
                  if (! disketteExtension__IsStarted) {
#line 319
                    Irp__IoStatus__Status = 0;
#line 320
                    myStatus = 0;
#line 321
                    if (s == NP) {
#line 322
                      s = SKIP1;
                    } else {
                      {
#line 325
                      errorFn();
                      }
                    }
                    {
#line 329
                    Irp__CurrentLocation ++;
#line 330
                    Irp__Tail__Overlay__CurrentStackLocation ++;
#line 331
                    ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                    }
                  } else {
#line 334
                    Irp__IoStatus__Status = 0;
#line 335
                    myStatus = 0;
#line 336
                    irpSp___0 = Irp__Tail__Overlay__CurrentStackLocation;
#line 337
                    nextIrpSp = Irp__Tail__Overlay__CurrentStackLocation - 1;
#line 338
                    nextIrpSp__Control = 0;
#line 339
                    if (s != NP) {
                      {
#line 341
                      errorFn();
                      }
                    } else {
#line 344
                      if (compRegistered != 0) {
                        {
#line 346
                        errorFn();
                        }
                      } else {
#line 349
                        compRegistered = 1;
                      }
                    }
                    {
#line 353
                    irpSp___1 = Irp__Tail__Overlay__CurrentStackLocation - 1;
#line 354
                    irpSp__Context = doneEvent;
#line 355
                    irpSp__Control = 0;
#line 356
                    irpSp__Control = 64;
#line 357
                    irpSp__Control |= 128;
#line 358
                    irpSp__Control |= 32;
#line 359
                    ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                    }
                    {
#line 361
                    __cil_tmp30 = (long )ntStatus;
#line 361
                    if (__cil_tmp30 == 259L) {
                      {
#line 363
                      KeWaitForSingleObject(doneEvent, Executive, KernelMode, 0, 0);
#line 364
                      ntStatus = myStatus;
                      }
                    }
                    }
                    {
#line 370
                    disketteExtension__HoldNewRequests = 0;
#line 371
                    Irp__IoStatus__Status = ntStatus;
#line 372
                    myStatus = ntStatus;
#line 373
                    Irp__IoStatus__Information = 0;
#line 374
                    IofCompleteRequest(Irp, 0);
                    }
                  }
                  goto switch_0_break;
                  switch_0_4: 
#line 379
                  disketteExtension__IsStarted = 0;
#line 380
                  Irp__IoStatus__Status = 0;
#line 381
                  myStatus = 0;
#line 382
                  if (s == NP) {
#line 383
                    s = SKIP1;
                  } else {
                    {
#line 386
                    errorFn();
                    }
                  }
                  {
#line 390
                  Irp__CurrentLocation ++;
#line 391
                  Irp__Tail__Overlay__CurrentStackLocation ++;
#line 392
                  ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                  }
                  goto switch_0_break;
                  switch_0_2: 
#line 396
                  disketteExtension__HoldNewRequests = 0;
#line 397
                  disketteExtension__IsStarted = 0;
#line 398
                  disketteExtension__IsRemoved = 1;
#line 399
                  if (s == NP) {
#line 400
                    s = SKIP1;
                  } else {
                    {
#line 403
                    errorFn();
                    }
                  }
                  {
#line 407
                  Irp__CurrentLocation ++;
#line 408
                  Irp__Tail__Overlay__CurrentStackLocation ++;
#line 409
                  Irp__IoStatus__Status = 0;
#line 410
                  myStatus = 0;
#line 411
                  ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                  }
#line 413
                  if (disketteExtension__InterfaceString__Buffer != 0) {
                    {
#line 415
                    IoSetDeviceInterfaceState(disketteExtension__InterfaceString,
                                              0);
                    }
                  }
#line 421
                  if (disketteExtension__ArcName__Length != 0) {
                    {
#line 423
                    IoDeleteSymbolicLink(disketteExtension__ArcName);
                    }
                  }
#line 428
                  IoGetConfigurationInformation__FloppyCount --;
                  goto switch_0_break;
                  switch_0_default: ;
#line 431
                  if (s == NP) {
#line 432
                    s = SKIP1;
                  } else {
                    {
#line 435
                    errorFn();
                    }
                  }
                  {
#line 439
                  Irp__CurrentLocation ++;
#line 440
                  Irp__Tail__Overlay__CurrentStackLocation ++;
#line 441
                  ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
                  }
                } else {
                  switch_0_break: ;
                }
              }
            }
          }
        }
      }
    }
  }
#line 454
  PagingReferenceCount --;
#line 455
  if (PagingReferenceCount == 0) {

  }
#line 460
  return (ntStatus);
}
}
#line 463 "floppy_simpl4_BUG.cil.c"
int FloppyStartDevice(int DeviceObject , int Irp ) 
{ int DeviceObject__DeviceExtension ;
  int Irp__Tail__Overlay__CurrentStackLocation ;
  int Irp__IoStatus__Status ;
  int disketteExtension__TargetObject ;
  int disketteExtension__MaxTransferSize ;
  int disketteExtension__DriveType ;
  int disketteExtension__PerpendicularMode ;
  int disketteExtension__DeviceUnit ;
  int disketteExtension__DriveOnValue ;
  int disketteExtension__UnderlyingPDO ;
  int disketteExtension__InterfaceString ;
  int disketteExtension__IsStarted ;
  int disketteExtension__HoldNewRequests ;
  int ntStatus ;
  int pnpStatus ;
  int doneEvent ;
  int fdcInfo ;
  int fdcInfo__BufferCount ;
  int fdcInfo__BufferSize ;
  int fdcInfo__MaxTransferSize ;
  int fdcInfo__AcpiBios ;
  int fdcInfo__AcpiFdiSupported ;
  int fdcInfo__PeripheralNumber ;
  int fdcInfo__BusType ;
  int fdcInfo__ControllerNumber ;
  int fdcInfo__UnitNumber ;
  int fdcInfo__BusNumber ;
  int Dc ;
  int Fp ;
  int disketteExtension ;
  int irpSp ;
  int irpSp___0 ;
  int nextIrpSp ;
  int nextIrpSp__Control ;
  int irpSp___1 ;
  int irpSp__Control ;
  int irpSp__Context ;
  int InterfaceType ;
  int KUSER_SHARED_DATA__AlternativeArchitecture_NEC98x86 ;
  long __cil_tmp42 ;
  int __cil_tmp43 ;
  int __cil_tmp44 ;
  int __cil_tmp45 ;
  int __cil_tmp46 ;
  int __cil_tmp47 ;
  int __cil_tmp48 ;
  int __cil_tmp49 ;

  {
#line 505
  Dc = DiskController;
#line 506
  Fp = FloppyDiskPeripheral;
#line 507
  disketteExtension = DeviceObject__DeviceExtension;
#line 508
  irpSp = Irp__Tail__Overlay__CurrentStackLocation;
#line 509
  irpSp___0 = Irp__Tail__Overlay__CurrentStackLocation;
#line 510
  nextIrpSp = Irp__Tail__Overlay__CurrentStackLocation - 1;
#line 511
  nextIrpSp__Control = 0;
#line 512
  if (s != NP) {
    {
#line 514
    errorFn();
    }
  } else {
#line 517
    if (compRegistered != 0) {
      {
#line 519
      errorFn();
      }
    } else {
#line 522
      compRegistered = 1;
    }
  }
  {
#line 526
  irpSp___1 = Irp__Tail__Overlay__CurrentStackLocation - 1;
#line 527
  irpSp__Context = doneEvent;
#line 528
  irpSp__Control = 0;
#line 529
  irpSp__Control = 64;
#line 530
  irpSp__Control |= 128;
#line 531
  irpSp__Control |= 32;
#line 532
  ntStatus = IofCallDriver(disketteExtension__TargetObject, Irp);
  }
  {
#line 534
  __cil_tmp42 = (long )ntStatus;
#line 534
  if (__cil_tmp42 == 259L) {
    {
#line 536
    ntStatus = KeWaitForSingleObject(doneEvent, Executive, KernelMode, 0, 0);
#line 537
    ntStatus = myStatus;
    }
  }
  }
  {
#line 543
  fdcInfo__BufferCount = 0;
#line 544
  fdcInfo__BufferSize = 0;
#line 545
  __cil_tmp43 = 770 << 2;
#line 545
  __cil_tmp44 = 7 << 16;
#line 545
  __cil_tmp45 = __cil_tmp44 | __cil_tmp43;
#line 545
  __cil_tmp46 = __cil_tmp45 | 3;
#line 545
  ntStatus = FlFdcDeviceIo(disketteExtension__TargetObject, __cil_tmp46, fdcInfo);
  }
#line 548
  if (ntStatus >= 0) {
#line 549
    disketteExtension__MaxTransferSize = fdcInfo__MaxTransferSize;
#line 550
    if (fdcInfo__AcpiBios) {
#line 551
      if (fdcInfo__AcpiFdiSupported) {
        {
#line 553
        ntStatus = FlAcpiConfigureFloppy(disketteExtension, fdcInfo);
        }
#line 555
        if (disketteExtension__DriveType == 4) {
#line 556
          __cil_tmp47 = 1 << fdcInfo__PeripheralNumber;
#line 556
          disketteExtension__PerpendicularMode |= __cil_tmp47;
        }
      } else {
        goto _L;
      }
    } else {
      _L: 
#line 565
      if (disketteExtension__DriveType == 4) {
#line 566
        __cil_tmp48 = 1 << fdcInfo__PeripheralNumber;
#line 566
        disketteExtension__PerpendicularMode |= __cil_tmp48;
      }
#line 570
      InterfaceType = 0;
      {
#line 572
      while (1) {
        while_0_continue: /* CIL Label */ ;

#line 574
        if (! (InterfaceType < MaximumInterfaceType)) {
          goto while_1_break;
        }
        {
#line 580
        fdcInfo__BusType = InterfaceType;
#line 581
        ntStatus = IoQueryDeviceDescription(fdcInfo__BusType, fdcInfo__BusNumber,
                                            Dc, fdcInfo__ControllerNumber, Fp, fdcInfo__PeripheralNumber,
                                            FlConfigCallBack, disketteExtension);
        }
#line 585
        if (ntStatus >= 0) {
          goto while_1_break;
        }
#line 590
        InterfaceType ++;
      }
      while_0_break: /* CIL Label */ ;
      }
      while_1_break: ;
    }
#line 595
    if (ntStatus >= 0) {
#line 596
      if (KUSER_SHARED_DATA__AlternativeArchitecture_NEC98x86 != 0) {
#line 597
        disketteExtension__DeviceUnit = fdcInfo__UnitNumber;
#line 598
        disketteExtension__DriveOnValue = fdcInfo__UnitNumber;
      } else {
#line 600
        disketteExtension__DeviceUnit = fdcInfo__PeripheralNumber;
#line 601
        __cil_tmp49 = 16 << fdcInfo__PeripheralNumber;
#line 601
        disketteExtension__DriveOnValue = fdcInfo__PeripheralNumber | __cil_tmp49;
      }
      {
#line 604
      pnpStatus = IoRegisterDeviceInterface(disketteExtension__UnderlyingPDO, MOUNTDEV_MOUNTED_DEVICE_GUID,
                                            0, disketteExtension__InterfaceString);
      }
#line 607
      if (pnpStatus >= 0) {
        {
#line 609
        pnpStatus = IoSetDeviceInterfaceState(disketteExtension__InterfaceString,
                                              1);
        }
      }
#line 615
      disketteExtension__IsStarted = 1;
#line 616
      disketteExtension__HoldNewRequests = 0;
    }
  }
  {
#line 624
  Irp__IoStatus__Status = ntStatus;
#line 625
  myStatus = ntStatus;
#line 626
  IofCompleteRequest(Irp, 0);
  }
#line 628
  return (ntStatus);
}
}
#line 631 "floppy_simpl4_BUG.cil.c"
int FloppyPnpComplete(int DeviceObject , int Irp , int Context ) 
{ 

  {
  {
#line 636
  KeSetEvent(Context, 1, 0);
  }
#line 638
  return (-1073741802);
}
}
#line 641 "floppy_simpl4_BUG.cil.c"
int FlFdcDeviceIo(int DeviceObject , int Ioctl , int Data ) 
{ int ntStatus ;
  int irp ;
  int irpStack ;
  int doneEvent ;
  int ioStatus ;
  int irp__Tail__Overlay__CurrentStackLocation ;
  int irpStack__Parameters__DeviceIoControl__Type3InputBuffer ;
  long __cil_tmp11 ;

  {
  {
#line 652
  irp = IoBuildDeviceIoControlRequest(Ioctl, DeviceObject, 0, 0, 0, 0, 1, doneEvent,
                                      ioStatus);
  }
#line 655
  if (irp == 0) {
#line 656
    return (-1073741670);
  }
  {
#line 661
  irpStack = irp__Tail__Overlay__CurrentStackLocation - 1;
#line 662
  irpStack__Parameters__DeviceIoControl__Type3InputBuffer = Data;
#line 663
  ntStatus = IofCallDriver(DeviceObject, irp);
  }
  {
#line 665
  __cil_tmp11 = (long )ntStatus;
#line 665
  if (__cil_tmp11 == 259L) {
    {
#line 667
    KeWaitForSingleObject(doneEvent, Suspended, KernelMode, 0, 0);
#line 668
    ntStatus = myStatus;
    }
  }
  }
#line 673
  return (ntStatus);
}
}
#line 676 "floppy_simpl4_BUG.cil.c"
void FloppyProcessQueuedRequests(int DisketteExtension ) 
{ 

  {
#line 680
  return;
}
}
#line 683 "floppy_simpl4_BUG.cil.c"
void stub_driver_init(void) 
{ 

  {
#line 687
  s = NP;
#line 688
  pended = 0;
#line 689
  compRegistered = 0;
#line 690
  lowerDriverReturn = 0;
#line 691
  setEventCalled = 0;
#line 692
  customIrp = 0;
#line 693
  return;
}
}
#line 696 "floppy_simpl4_BUG.cil.c"
int main(void) 
{ int status ;
  int irp ;
  int pirp ;
  int pirp__IoStatus__Status ;
  int __BLAST_NONDET ;
  int irp_choice ;
  int devobj ;
  int __cil_tmp8 ;

  {
  {
#line 707
  status = 0;
#line 708
  pirp = irp;
#line 709
  _BLAST_init();
  }
#line 711
  if (status >= 0) {
#line 712
    s = NP;
#line 713
    customIrp = 0;
#line 714
    setEventCalled = customIrp;
#line 715
    lowerDriverReturn = setEventCalled;
#line 716
    compRegistered = lowerDriverReturn;
#line 717
    pended = compRegistered;
#line 718
    pirp__IoStatus__Status = 0;
#line 719
    myStatus = 0;
#line 720
    if (irp_choice == 0) {
#line 721
      pirp__IoStatus__Status = -1073741637;
#line 722
      myStatus = -1073741637;
    }
    {
#line 727
    stub_driver_init();
    }
    {
#line 729
    __cil_tmp8 = status >= 0;
#line 729
    if (! __cil_tmp8) {
#line 730
      return (-1);
    }
    }
#line 734
    if (__BLAST_NONDET == 0) {
      goto switch_2_0;
    } else {
#line 737
      if (__BLAST_NONDET == 1) {
        goto switch_2_1;
      } else {
#line 740
        if (__BLAST_NONDET == 2) {
          goto switch_2_2;
        } else {
#line 743
          if (__BLAST_NONDET == 3) {
            goto switch_2_3;
          } else {
            goto switch_2_default;
#line 748
            if (0) {
              switch_2_0: 
              {
#line 751
              status = FloppyCreateClose(devobj, pirp);
              }
              goto switch_2_break;
              switch_2_1: 
              {
#line 756
              status = FloppyCreateClose(devobj, pirp);
              }
              goto switch_2_break;
              switch_2_2: 
              {
#line 761
              status = FloppyDeviceControl(devobj, pirp);
              }
              goto switch_2_break;
              switch_2_3: 
              {
#line 766
              status = FloppyPnp(devobj, pirp);
              }
              goto switch_2_break;
              switch_2_default: ;
#line 770
              return (-1);
            } else {
              switch_2_break: ;
            }
          }
        }
      }
    }
  }
#line 782
  if (pended == 1) {
#line 783
    if (s == NP) {
#line 784
      s = NP;
    } else {
      goto _L___2;
    }
  } else {
    _L___2: 
#line 790
    if (pended == 1) {
#line 791
      if (s == MPR3) {
#line 792
        s = MPR3;
      } else {
        goto _L___1;
      }
    } else {
      _L___1: 
#line 798
      if (! (s == UNLOADED)) {
#line 801
        if (! (status == -1)) {
#line 804
          if (s != SKIP2) {
#line 805
            if (s != IPC) {
#line 806
              if (s != DC) {
                {
#line 808
                errorFn();
                }
              } else {
                goto _L___0;
              }
            } else {
              goto _L___0;
            }
          } else {
            _L___0: 
#line 818
            if (pended == 1) {
#line 819
              if (status != 259) {
                {
#line 821
                errorFn();
                }
              }
            } else {
#line 827
              if (s == DC) {
#line 828
                if (status == 259) {
                  {
#line 830
                  errorFn();
                  }
                }
              } else {
#line 836
                if (status != lowerDriverReturn) {
                  {
#line 838
                  errorFn();
                  }
                }
              }
            }
          }
        }
      }
    }
  }
#line 850
  status = 0;
#line 851
  return (status);
}
}
#line 854 "floppy_simpl4_BUG.cil.c"
int IoBuildDeviceIoControlRequest(int IoControlCode , int DeviceObject , int InputBuffer ,
                                  int InputBufferLength , int OutputBuffer , int OutputBufferLength ,
                                  int InternalDeviceIoControl , int Event , int IoStatusBlock ) 
{ int __BLAST_NONDET ;
  int malloc ;

  {
#line 861
  customIrp = 1;
#line 862
  if (__BLAST_NONDET == 0) {
    goto switch_3_0;
  } else {
    goto switch_3_default;
#line 867
    if (0) {
      switch_3_0: 
#line 869
      return (malloc);
      switch_3_default: ;
#line 871
      return (0);
    } else {

    }
  }
}
}
#line 879 "floppy_simpl4_BUG.cil.c"
int IoDeleteSymbolicLink(int SymbolicLinkName ) 
{ int __BLAST_NONDET ;

  {
#line 883
  if (__BLAST_NONDET == 0) {
    goto switch_4_0;
  } else {
    goto switch_4_default;
#line 888
    if (0) {
      switch_4_0: 
#line 890
      return (0);
      switch_4_default: ;
#line 892
      return (-1073741823);
    } else {

    }
  }
}
}
#line 900 "floppy_simpl4_BUG.cil.c"
int IoQueryDeviceDescription(int BusType , int BusNumber , int ControllerType , int ControllerNumber ,
                             int PeripheralType , int PeripheralNumber , int CalloutRoutine ,
                             int Context ) 
{ int __BLAST_NONDET ;

  {
#line 906
  if (__BLAST_NONDET == 0) {
    goto switch_5_0;
  } else {
    goto switch_5_default;
#line 911
    if (0) {
      switch_5_0: 
#line 913
      return (0);
      switch_5_default: ;
#line 915
      return (-1073741823);
    } else {

    }
  }
}
}
#line 923 "floppy_simpl4_BUG.cil.c"
int IoRegisterDeviceInterface(int PhysicalDeviceObject , int InterfaceClassGuid ,
                              int ReferenceString , int SymbolicLinkName ) 
{ int __BLAST_NONDET ;

  {
#line 928
  if (__BLAST_NONDET == 0) {
    goto switch_6_0;
  } else {
    goto switch_6_default;
#line 933
    if (0) {
      switch_6_0: 
#line 935
      return (0);
      switch_6_default: ;
#line 937
      return (-1073741808);
    } else {

    }
  }
}
}
#line 945 "floppy_simpl4_BUG.cil.c"
int IoSetDeviceInterfaceState(int SymbolicLinkName , int Enable ) 
{ int __BLAST_NONDET ;

  {
#line 949
  if (__BLAST_NONDET == 0) {
    goto switch_7_0;
  } else {
    goto switch_7_default;
#line 954
    if (0) {
      switch_7_0: 
#line 956
      return (0);
      switch_7_default: ;
#line 958
      return (-1073741823);
    } else {

    }
  }
}
}
#line 966 "floppy_simpl4_BUG.cil.c"
void stubMoreProcessingRequired(void) 
{ 

  {
#line 970
  if (s == NP) {
#line 971
    s = MPR1;
  } else {
    {
#line 974
    errorFn();
    }
  }
#line 977
  return;
}
}
#line 980 "floppy_simpl4_BUG.cil.c"
int IofCallDriver(int DeviceObject , int Irp ) 
{ int __BLAST_NONDET ;
  int returnVal2 ;
  int compRetStatus1 ;
  int lcontext ;
  unsigned long __cil_tmp7 ;

  {
#line 987
  if (compRegistered) {
    {
#line 989
    compRetStatus1 = FloppyPnpComplete(DeviceObject, Irp, lcontext);
    }
    {
#line 991
    __cil_tmp7 = (unsigned long )compRetStatus1;
#line 991
    if (__cil_tmp7 == 3221225494UL) {
      {
#line 993
      stubMoreProcessingRequired();
      }
    }
    }
  }
#line 1001
  if (__BLAST_NONDET == 0) {
    goto switch_8_0;
  } else {
#line 1004
    if (__BLAST_NONDET == 1) {
      goto switch_8_1;
    } else {
      goto switch_8_default;
#line 1009
      if (0) {
        switch_8_0: 
#line 1011
        returnVal2 = 0;
        goto switch_8_break;
        switch_8_1: 
#line 1014
        returnVal2 = -1073741823;
        goto switch_8_break;
        switch_8_default: 
#line 1017
        returnVal2 = 259;
        goto switch_8_break;
      } else {
        switch_8_break: ;
      }
    }
  }
#line 1025
  if (s == NP) {
#line 1026
    s = IPC;
#line 1027
    lowerDriverReturn = returnVal2;
  } else {
#line 1029
    if (s == MPR1) {
#line 1030
      if (returnVal2 == 259) {
#line 1031
        s = MPR3;
#line 1032
        lowerDriverReturn = returnVal2;
      } else {
#line 1034
        s = NP;
#line 1035
        lowerDriverReturn = returnVal2;
      }
    } else {
#line 1038
      if (s == SKIP1) {
#line 1039
        s = SKIP2;
#line 1040
        lowerDriverReturn = returnVal2;
      } else {
        {
#line 1043
        errorFn();
        }
      }
    }
  }
#line 1048
  return (returnVal2);
}
}
#line 1051 "floppy_simpl4_BUG.cil.c"
void IofCompleteRequest(int Irp , int PriorityBoost ) 
{ 

  {
#line 1055
  if (s == NP) {
#line 1056
    s = DC;
  } else {
    {
#line 1059
    errorFn();
    }
  }
#line 1062
  return;
}
}
#line 1065 "floppy_simpl4_BUG.cil.c"
int KeSetEvent(int Event , int Increment , int Wait ) 
{ int l ;

  {
#line 1069
  setEventCalled = 1;
#line 1070
  return (l);
}
}
#line 1073 "floppy_simpl4_BUG.cil.c"
int KeWaitForSingleObject(int Object , int WaitReason , int WaitMode , int Alertable ,
                          int Timeout ) 
{ int __BLAST_NONDET ;

  {
#line 1078
  if (s == MPR3) {
#line 1079
    if (setEventCalled == 1) {
#line 1080
      s = NP;
#line 1081
      setEventCalled = 0;
    } else {
      goto _L;
    }
  } else {
    _L: 
#line 1087
    if (customIrp == 1) {
#line 1088
      s = NP;
#line 1089
      customIrp = 0;
    } else {
#line 1091
      if (s == MPR3) {
        {
#line 1093
        errorFn();
        }
      }
    }
  }
#line 1100
  if (__BLAST_NONDET == 0) {
    goto switch_9_0;
  } else {
    goto switch_9_default;
#line 1105
    if (0) {
      switch_9_0: 
#line 1107
      return (0);
      switch_9_default: ;
#line 1109
      return (-1073741823);
    } else {

    }
  }
}
}
#line 1117 "floppy_simpl4_BUG.cil.c"
int ObReferenceObjectByHandle(int Handle , int DesiredAccess , int ObjectType , int AccessMode ,
                              int Object , int HandleInformation ) 
{ int __BLAST_NONDET ;

  {
#line 1122
  if (__BLAST_NONDET == 0) {
    goto switch_10_0;
  } else {
    goto switch_10_default;
#line 1127
    if (0) {
      switch_10_0: 
#line 1129
      return (0);
      switch_10_default: ;
#line 1131
      return (-1073741823);
    } else {

    }
  }
}
}
#line 1139 "floppy_simpl4_BUG.cil.c"
int PsCreateSystemThread(int ThreadHandle , int DesiredAccess , int ObjectAttributes ,
                         int ProcessHandle , int ClientId , int StartRoutine , int StartContext ) 
{ int __BLAST_NONDET ;

  {
#line 1144
  if (__BLAST_NONDET == 0) {
    goto switch_11_0;
  } else {
    goto switch_11_default;
#line 1149
    if (0) {
      switch_11_0: 
#line 1151
      return (0);
      switch_11_default: ;
#line 1153
      return (-1073741823);
    } else {

    }
  }
}
}
#line 1161 "floppy_simpl4_BUG.cil.c"
int ZwClose(int Handle ) 
{ int __BLAST_NONDET ;

  {
#line 1165
  if (__BLAST_NONDET == 0) {
    goto switch_12_0;
  } else {
    goto switch_12_default;
#line 1170
    if (0) {
      switch_12_0: 
#line 1172
      return (0);
      switch_12_default: ;
#line 1174
      return (-1073741823);
    } else {

    }
  }
}
}
#line 1182 "floppy_simpl4_BUG.cil.c"
int FloppyCreateClose(int DeviceObject , int Irp ) 
{ int Irp__IoStatus__Status ;
  int Irp__IoStatus__Information ;

  {
  {
#line 1188
  myStatus = 0;
#line 1189
  Irp__IoStatus__Status = 0;
#line 1190
  Irp__IoStatus__Information = 1;
#line 1191
  IofCompleteRequest(Irp, 0);
  }
#line 1193
  return (0);
}
}
#line 1196
int FloppyQueueRequest(int DisketteExtension , int Irp ) ;
#line 1197 "floppy_simpl4_BUG.cil.c"
int FloppyDeviceControl(int DeviceObject , int Irp ) 
{ int disketteExtension__HoldNewRequests ;
  int disketteExtension__IsRemoved ;
  int Irp__IoStatus__Information ;
  int disketteExtension__IsStarted ;
  int Irp__CurrentLocation ;
  int Irp__Tail__Overlay__CurrentStackLocation ;
  int disketteExtension__TargetObject ;
  int irpSp__Parameters__DeviceIoControl__OutputBufferLength ;
  int sizeof__MOUNTDEV_NAME ;
  int Irp__AssociatedIrp__SystemBuffer ;
  int mountName__NameLength ;
  int disketteExtension__DeviceName__Length ;
  int sizeof__USHORT ;
  int disketteExtension__InterfaceString__Buffer ;
  int uniqueId__UniqueIdLength ;
  int disketteExtension__InterfaceString__Length ;
  int sizeof__MOUNTDEV_UNIQUE_ID ;
  int irpSp__Parameters__DeviceIoControl__InputBufferLength ;
  int sizeof__FORMAT_PARAMETERS ;
  int irpSp__Parameters__DeviceIoControl__IoControlCode___1 ;
  int sizeof__FORMAT_EX_PARAMETERS ;
  int formatExParameters__FormatGapLength ;
  int formatExParameters__SectorsPerTrack ;
  int sizeof__DISK_GEOMETRY ;
  int Irp__IoStatus__Status___0 ;
  int disketteExtension ;
  int ntStatus ;
  int outputBufferLength ;
  int lowestDriveMediaType ;
  int highestDriveMediaType ;
  int formatExParametersSize ;
  int formatExParameters ;
  int tmp ;
  int mountName ;
  int uniqueId ;
  int tmp___0 ;
  int __cil_tmp39 ;
  int __cil_tmp40 ;
  int __cil_tmp41 ;
  int __cil_tmp42 ;
  int __cil_tmp43 ;
  int __cil_tmp44 ;
  int __cil_tmp45 ;
  int __cil_tmp46 ;
  int __cil_tmp47 ;
  int __cil_tmp48 ;
  int __cil_tmp49 ;
  int __cil_tmp50 ;
  int __cil_tmp51 ;
  int __cil_tmp52 ;
  int __cil_tmp53 ;
  int __cil_tmp54 ;
  int __cil_tmp55 ;
  int __cil_tmp56 ;
  int __cil_tmp57 ;
  int __cil_tmp58 ;
  int __cil_tmp59 ;
  int __cil_tmp60 ;
  int __cil_tmp61 ;
  int __cil_tmp62 ;
  int __cil_tmp63 ;
  int __cil_tmp64 ;
  int __cil_tmp65 ;
  int __cil_tmp66 ;
  int __cil_tmp67 ;
  int __cil_tmp68 ;
  int __cil_tmp69 ;
  int __cil_tmp70 ;
  int __cil_tmp71 ;
  int __cil_tmp72 ;
  int __cil_tmp73 ;
  int __cil_tmp74 ;
  int __cil_tmp75 ;
  int __cil_tmp76 ;
  int __cil_tmp77 ;
  int __cil_tmp78 ;
  int __cil_tmp79 ;
  int __cil_tmp80 ;
  int __cil_tmp81 ;
  int __cil_tmp82 ;
  int __cil_tmp83 ;
  int __cil_tmp84 ;
  int __cil_tmp85 ;
  int __cil_tmp86 ;
  int __cil_tmp87 ;
  int __cil_tmp88 ;
  int __cil_tmp89 ;
  int __cil_tmp90 ;
  long __cil_tmp91 ;

  {
#line 1236
  if (disketteExtension__HoldNewRequests) {
    {
#line 1237
    __cil_tmp39 = 3 << 14;
#line 1237
    __cil_tmp40 = 50 << 16;
#line 1237
    __cil_tmp41 = __cil_tmp40 | __cil_tmp39;
#line 1237
    if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 != __cil_tmp41) {
      {
#line 1239
      ntStatus = FloppyQueueRequest(disketteExtension, Irp);
      }
#line 1241
      return (ntStatus);
    }
    }
  }
#line 1248
  if (disketteExtension__IsRemoved) {
    {
#line 1250
    Irp__IoStatus__Information = 0;
#line 1251
    Irp__IoStatus__Status___0 = -1073741738;
#line 1252
    myStatus = -1073741738;
#line 1253
    IofCompleteRequest(Irp, 0);
    }
#line 1255
    return (-1073741738);
  }
#line 1259
  if (! disketteExtension__IsStarted) {
#line 1260
    if (s == NP) {
#line 1261
      s = SKIP1;
    } else {
      {
#line 1264
      errorFn();
      }
    }
    {
#line 1268
    Irp__CurrentLocation ++;
#line 1269
    Irp__Tail__Overlay__CurrentStackLocation ++;
#line 1270
    tmp = IofCallDriver(disketteExtension__TargetObject, Irp);
    }
#line 1272
    return (tmp);
  }
  {
#line 1276
  __cil_tmp42 = 2 << 2;
#line 1276
  __cil_tmp43 = 77 << 16;
#line 1276
  __cil_tmp44 = __cil_tmp43 | __cil_tmp42;
#line 1276
  if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp44) {
    goto switch_13_exp_0;
  } else {
    {
#line 1279
    __cil_tmp45 = 77 << 16;
#line 1279
    if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp45) {
      goto switch_13_exp_1;
    } else {
      {
#line 1282
      __cil_tmp46 = 6 << 2;
#line 1282
      __cil_tmp47 = 3 << 14;
#line 1282
      __cil_tmp48 = 7 << 16;
#line 1282
      __cil_tmp49 = __cil_tmp48 | __cil_tmp47;
#line 1282
      __cil_tmp50 = __cil_tmp49 | __cil_tmp46;
#line 1282
      if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp50) {
        goto switch_13_exp_2;
      } else {
        {
#line 1285
        __cil_tmp51 = 11 << 2;
#line 1285
        __cil_tmp52 = 3 << 14;
#line 1285
        __cil_tmp53 = 7 << 16;
#line 1285
        __cil_tmp54 = __cil_tmp53 | __cil_tmp52;
#line 1285
        __cil_tmp55 = __cil_tmp54 | __cil_tmp51;
#line 1285
        if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp55) {
          goto switch_13_exp_3;
        } else {
          {
#line 1288
          __cil_tmp56 = 512 << 2;
#line 1288
          __cil_tmp57 = 1 << 14;
#line 1288
          __cil_tmp58 = 7 << 16;
#line 1288
          __cil_tmp59 = __cil_tmp58 | __cil_tmp57;
#line 1288
          __cil_tmp60 = __cil_tmp59 | __cil_tmp56;
#line 1288
          if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp60) {
            goto switch_13_exp_4;
          } else {
            {
#line 1291
            __cil_tmp61 = 512 << 2;
#line 1291
            __cil_tmp62 = 1 << 14;
#line 1291
            __cil_tmp63 = 45 << 16;
#line 1291
            __cil_tmp64 = __cil_tmp63 | __cil_tmp62;
#line 1291
            __cil_tmp65 = __cil_tmp64 | __cil_tmp61;
#line 1291
            if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp65) {
              goto switch_13_exp_5;
            } else {
              {
#line 1294
              __cil_tmp66 = 7 << 16;
#line 1294
              if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp66) {
                goto switch_13_exp_6;
              } else {
                {
#line 1297
                __cil_tmp67 = 9 << 2;
#line 1297
                __cil_tmp68 = 7 << 16;
#line 1297
                __cil_tmp69 = __cil_tmp68 | __cil_tmp67;
#line 1297
                if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp69) {
                  goto switch_13_exp_7;
                } else {
                  {
#line 1300
                  __cil_tmp70 = 768 << 2;
#line 1300
                  __cil_tmp71 = 7 << 16;
#line 1300
                  __cil_tmp72 = __cil_tmp71 | __cil_tmp70;
#line 1300
                  if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp72) {
                    goto switch_13_exp_8;
                  } else {
                    {
#line 1303
                    __cil_tmp73 = 768 << 2;
#line 1303
                    __cil_tmp74 = 45 << 16;
#line 1303
                    __cil_tmp75 = __cil_tmp74 | __cil_tmp73;
#line 1303
                    if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp75) {
                      goto switch_13_exp_9;
                    } else {
                      {
#line 1306
                      __cil_tmp76 = 3 << 2;
#line 1306
                      __cil_tmp77 = 77 << 16;
#line 1306
                      __cil_tmp78 = __cil_tmp77 | __cil_tmp76;
#line 1306
                      if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp78) {
                        goto switch_13_exp_10;
                      } else {
                        {
#line 1309
                        __cil_tmp79 = 248 << 2;
#line 1309
                        __cil_tmp80 = 7 << 16;
#line 1309
                        __cil_tmp81 = __cil_tmp80 | __cil_tmp79;
#line 1309
                        if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp81) {
                          goto switch_13_exp_11;
                        } else {
                          goto switch_13_default;
#line 1314
                          if (0) {
                            switch_13_exp_0: ;
#line 1316
                            if (irpSp__Parameters__DeviceIoControl__OutputBufferLength < sizeof__MOUNTDEV_NAME) {
#line 1317
                              ntStatus = -1073741811;
                              goto switch_13_break;
                            }
#line 1322
                            mountName = Irp__AssociatedIrp__SystemBuffer;
#line 1323
                            mountName__NameLength = disketteExtension__DeviceName__Length;
                            {
#line 1324
                            __cil_tmp82 = sizeof__USHORT + mountName__NameLength;
#line 1324
                            if (irpSp__Parameters__DeviceIoControl__OutputBufferLength < __cil_tmp82) {
#line 1325
                              ntStatus = -2147483643;
#line 1326
                              Irp__IoStatus__Information = sizeof__MOUNTDEV_NAME;
                              goto switch_13_break;
                            }
                            }
#line 1331
                            ntStatus = 0;
#line 1332
                            Irp__IoStatus__Information = sizeof__USHORT + mountName__NameLength;
                            goto switch_13_break;
                            switch_13_exp_1: ;
#line 1335
                            if (! disketteExtension__InterfaceString__Buffer) {
#line 1336
                              ntStatus = -1073741811;
                              goto switch_13_break;
                            } else {
#line 1339
                              if (irpSp__Parameters__DeviceIoControl__OutputBufferLength < sizeof__MOUNTDEV_UNIQUE_ID) {
#line 1340
                                ntStatus = -1073741811;
                                goto switch_13_break;
                              }
                            }
#line 1346
                            uniqueId = Irp__AssociatedIrp__SystemBuffer;
#line 1347
                            uniqueId__UniqueIdLength = disketteExtension__InterfaceString__Length;
                            {
#line 1348
                            __cil_tmp83 = sizeof__USHORT + uniqueId__UniqueIdLength;
#line 1348
                            if (irpSp__Parameters__DeviceIoControl__OutputBufferLength < __cil_tmp83) {
#line 1349
                              ntStatus = -2147483643;
#line 1350
                              Irp__IoStatus__Information = sizeof__MOUNTDEV_UNIQUE_ID;
                              goto switch_13_break;
                            }
                            }
#line 1355
                            ntStatus = 0;
#line 1356
                            Irp__IoStatus__Information = sizeof__USHORT + uniqueId__UniqueIdLength;
                            goto switch_13_break;
                            switch_13_exp_2: ;
                            switch_13_exp_3: ;
#line 1360
                            if (irpSp__Parameters__DeviceIoControl__InputBufferLength < sizeof__FORMAT_PARAMETERS) {
#line 1361
                              ntStatus = -1073741811;
                              goto switch_13_break;
                            }
                            {
#line 1367
                            tmp___0 = FlCheckFormatParameters(disketteExtension, Irp__AssociatedIrp__SystemBuffer);
                            }
#line 1369
                            if (! tmp___0) {
#line 1372
                              ntStatus = -1073741811;
                              goto switch_13_break;
                            }
                            {
#line 1375
                            __cil_tmp84 = 11 << 2;
#line 1375
                            __cil_tmp85 = 3 << 14;
#line 1375
                            __cil_tmp86 = 7 << 16;
#line 1375
                            __cil_tmp87 = __cil_tmp86 | __cil_tmp85;
#line 1375
                            __cil_tmp88 = __cil_tmp87 | __cil_tmp84;
#line 1375
                            if (irpSp__Parameters__DeviceIoControl__IoControlCode___1 == __cil_tmp88) {
#line 1376
                              if (irpSp__Parameters__DeviceIoControl__InputBufferLength < sizeof__FORMAT_EX_PARAMETERS) {
#line 1377
                                ntStatus = -1073741811;
                                goto switch_13_break;
                              }
#line 1382
                              formatExParameters = Irp__AssociatedIrp__SystemBuffer;
#line 1383
                              if (irpSp__Parameters__DeviceIoControl__InputBufferLength < formatExParametersSize) {
#line 1384
                                ntStatus = -1073741811;
                                goto switch_13_break;
                              } else {
#line 1387
                                if (formatExParameters__FormatGapLength >= 256) {
#line 1388
                                  ntStatus = -1073741811;
                                  goto switch_13_break;
                                } else {
#line 1391
                                  if (formatExParameters__SectorsPerTrack >= 256) {
#line 1392
                                    ntStatus = -1073741811;
                                    goto switch_13_break;
                                  }
                                }
                              }
                            }
                            }
                            switch_13_exp_4: ;
                            switch_13_exp_5: ;
                            switch_13_exp_6: ;
                            switch_13_exp_7: 
                            {
#line 1407
                            ntStatus = FlQueueIrpToThread(Irp, disketteExtension);
                            }
                            goto switch_13_break;
                            switch_13_exp_8: ;
                            switch_13_exp_9: 
#line 1412
                            outputBufferLength = irpSp__Parameters__DeviceIoControl__OutputBufferLength;
#line 1413
                            if (outputBufferLength < sizeof__DISK_GEOMETRY) {
#line 1414
                              ntStatus = -1073741789;
                              goto switch_13_break;
                            }
#line 1419
                            ntStatus = 0;
                            {
#line 1420
                            __cil_tmp89 = highestDriveMediaType - lowestDriveMediaType;
#line 1420
                            __cil_tmp90 = __cil_tmp89 + 1;
#line 1420
                            if (outputBufferLength < __cil_tmp90) {
#line 1421
                              ntStatus = -2147483643;
                            }
                            }
                            goto switch_13_break;
                            switch_13_exp_10: ;
                            switch_13_exp_11: ;
                            switch_13_default: ;
#line 1429
                            if (s == NP) {
#line 1430
                              s = SKIP1;
                            } else {
                              {
#line 1433
                              errorFn();
                              }
                            }
                            {
#line 1437
                            Irp__CurrentLocation ++;
#line 1438
                            Irp__Tail__Overlay__CurrentStackLocation ++;
#line 1439
                            ntStatus = IofCallDriver(disketteExtension__TargetObject,
                                                     Irp);
                            }
#line 1442
                            return (ntStatus);
                          } else {
                            switch_13_break: ;
                          }
                        }
                        }
                      }
                      }
                    }
                    }
                  }
                  }
                }
                }
              }
              }
            }
            }
          }
          }
        }
        }
      }
      }
    }
    }
  }
  }
  {
#line 1459
  __cil_tmp91 = (long )ntStatus;
#line 1459
  if (__cil_tmp91 != 259L) {
    {
#line 1461
    Irp__IoStatus__Status___0 = ntStatus;
#line 1462
    myStatus = ntStatus;
#line 1463
    IofCompleteRequest(Irp, 0);
    }
  }
  }
#line 1468
  return (ntStatus);
}
}
#line 1471 "floppy_simpl4_BUG.cil.c"
int FlCheckFormatParameters(int DisketteExtension , int FormatParameters ) 
{ int DriveMediaConstants__driveMediaType__MediaType ;
  int FormatParameters__MediaType ;
  int FAKE_CONDITION ;

  {
#line 1477
  if (DriveMediaConstants__driveMediaType__MediaType != FormatParameters__MediaType) {
#line 1478
    return (0);
  } else {
#line 1480
    if (FAKE_CONDITION) {
#line 1481
      return (0);
    } else {
#line 1483
      return (1);
    }
  }
}
}
#line 1488 "floppy_simpl4_BUG.cil.c"
int FloppyQueueRequest(int DisketteExtension , int Irp ) 
{ int Irp__IoStatus__Status ;
  int Irp__IoStatus__Information ;
  int Irp__Tail__Overlay__CurrentStackLocation__Control ;
  int ntStatus ;
  int FAKE_CONDITION ;

  {
#line 1496
  PagingReferenceCount ++;
#line 1497
  if (PagingReferenceCount == 1) {

  }
#line 1502
  if (FAKE_CONDITION) {
    {
#line 1504
    Irp__IoStatus__Status = -1073741536;
#line 1505
    myStatus = -1073741536;
#line 1506
    Irp__IoStatus__Information = 0;
#line 1507
    IofCompleteRequest(Irp, 0);
#line 1508
    PagingReferenceCount --;
    }
#line 1510
    if (PagingReferenceCount == 0) {

    }
#line 1515
    ntStatus = -1073741536;
  } else {
#line 1517
    Irp__IoStatus__Status = 259;
#line 1518
    myStatus = 259;
#line 1519
    Irp__Tail__Overlay__CurrentStackLocation__Control |= 1;
#line 1520
    if (pended == 0) {
#line 1521
      pended = 1;
    } else {
      {
#line 1524
      errorFn();
      }
    }
#line 1527
    ntStatus = 259;
  }
#line 1529
  return (ntStatus);
}
}
