<?xml version="1.0" encoding="UTF-8" ?>
<!-- vim: set tabstop=8 shiftwidth=4 expandtab filetype=ant : -->
<project name="Antlr4 parser generation" default="generate-antlr4-parser" basedir="./../../../../../../">
	<!-- basedir should be the "CPAchecker" directory -->

	<property name="dir.src" location="src/org/sosy_lab/cpachecker/util/ltl/" />
	<property name="dir.generated" location="src/org/sosy_lab/cpachecker/util/ltl/generated/" />

	<property name="grammar.source" value="LtlGrammar" />

	<property name="antlr4.jar" value="./lib/java/runtime/antlr4.jar" />
	<property name="antlr_runtime.jar" value="./lib/java/runtime/antlr-runtime.jar" />
	<property name="antlr4_runtime.jar" value="./lib/java/runtime/antlr4-runtime.jar" />
	<property name="st4.jar" value="./lib/java/runtime/ST4.jar" />

	<target name="echos">
		<echo>${dir.src}</echo>
		<echo>${dir.generated}</echo>
		<echo>"is antlr4 up to date? ${is.antlr4.uptodate}"</echo>
	</target>

	<target name="clean" description="Delete generated files">
		<delete dir="${dir.generated}" />
	</target>

	<path id="cp.antlr4">
		<pathelement location="${antlr4.jar}" />
		<pathelement location="${antlr_runtime.jar}" />
		<pathelement location="${antlr4_runtime.jar}" />
		<pathelement location="${st4.jar}" />
	</path>

	<uptodate srcfile="${dir.src}/${grammar.source}.g4" property="is.antlr4.uptodate">
		<compositemapper>
			<mergemapper to="${dir.generated}" />
			<mergemapper to="${dir.generated}/${grammar.source}BaseVisitor.java" />
			<mergemapper to="${dir.generated}/${grammar.source}Lexer.java" />
			<mergemapper to="${dir.generated}/${grammar.source}Parser.java" />
			<mergemapper to="${dir.generated}/${grammar.source}Visitor.java" />
			<mergemapper to="${dir.generated}/${grammar.source}.interp" />
			<mergemapper to="${dir.generated}/${grammar.source}.tokens" />
			<mergemapper to="${dir.generated}/${grammar.source}Lexer.interp" />
			<mergemapper to="${dir.generated}/${grammar.source}Lexer.tokens" />
		</compositemapper>
	</uptodate>

	<target name="generate-antlr4-parser" unless="is.antlr4.uptodate" description="Generate antlr4 parser">
		<java classname="org.antlr.v4.Tool" fork="true" failonerror="true" dir="${dir.src}">
			<arg value="-o" />
			<arg value="generated" />
			<arg value="-package" />
			<arg value="org.sosy_lab.cpachecker.util.ltl.generated" />
			<arg value="-visitor" />
			<arg value="-no-listener" />
			<arg value="${grammar.source}.g4" />
			<classpath>
				<path refid="cp.antlr4" />
			</classpath>
		</java>
		<echo message="Generated: ${dir.generated}/*" level="info" />
	</target>

</project>
